\begin{Verbatim}[commandchars=\\\{\},codes={\catcode`\$=3\catcode`\^=7\catcode`\_=8}]
\PY{c+cm}{/* arg is a function parameter}
\PY{c+cm}{ * user\PYZus{}ptr points to a user-space list */}
\PY{k}{if} \PY{p}{(}\PY{n}{arg}\PY{o}{-}\PY{o}{\PYZgt{}}\PY{n}{count} \PY{o}{\PYZlt{}} \PY{l+m+mi}{1} \PY{o}{|}\PY{o}{|} \PY{n}{arg}\PY{o}{-}\PY{o}{\PYZgt{}}\PY{n}{count} \PY{o}{\PYZgt{}} \PY{l+m+mi}{128}\PY{p}{)}
    \PY{k}{return} \PY{o}{-}\PY{n}{EINVAL}\PY{p}{;}
\PY{k+kt}{int} \PY{o}{*}\PY{n}{klist} \PY{o}{=} \PY{n}{kmalloc}\PY{p}{(}\PY{n}{arg}\PY{o}{-}\PY{o}{\PYZgt{}}\PY{n}{count} \PY{o}{*} \PY{k}{sizeof}\PY{p}{(}\PY{k+kt}{int}\PY{p}{)}\PY{p}{,} \PY{p}{.}\PY{p}{.}\PY{p}{.}\PY{p}{)}\PY{p}{;}
\PY{k}{if} \PY{p}{(}\PY{o}{!}\PY{n}{klist}\PY{p}{)}
    \PY{k}{return} \PY{o}{-}\PY{n}{ENOMEM}\PY{p}{;}
\PY{n}{ret} \PY{o}{=} \PY{n}{copy\PYZus{}from\PYZus{}user}\PY{p}{(}\PY{n}{klist}\PY{p}{,} \PY{n}{user\PYZus{}ptr}\PY{p}{,}
                     \PY{n}{arg}\PY{o}{-}\PY{o}{\PYZgt{}}\PY{n}{count} \PY{o}{*} \PY{k}{sizeof}\PY{p}{(}\PY{k+kt}{int}\PY{p}{)}\PY{p}{)}\PY{p}{;}
\end{Verbatim}
