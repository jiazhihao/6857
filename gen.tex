\section{Design}
\label{s:gen}

This section describes \sys's design for constraint generation and
solving.

\subsection{Basic Architecture}

\sys's constraint generator is implemented as a set of compiler
passes in the LLVM~\cite{lattner:llvm} framework.  The workflow is
shown in \autoref{f:flow}.  The error and path constraint generation
passes work on LLVM intermediate representations, which are compiled
from source code with all optimizations turned off.  They inspect
one function at a time, so as to bound the size of constraints.

To improve the accuracy, \sys allows users to annotate the ranges
of variables, such as function parameters and structure fields, as
additional constraints. It also employs a whole-program pass that
infers the range constraints across the call graph.

\begin{figure}
\centering
\resizebox{0.9\linewidth}{!}{
\input{figs/flow}
}
\caption{\sys's workflow.}
\label{f:flow}
\end{figure}

\subsection{Transformations}

Pointer arithmetic simplification.
- symbolic~\cite{engelen:symbolic}.

Integer operation sinking.

Checking idiom recognition.

\paragraph{Value equality testing.}
How to determine the values from two load instructions
are the same? Load hoisting, unsound aliasing rules.

\autoref{f:hoist} shows in the hoisting algorithm.

\begin{figure}
\input{algo/hoist}
\caption{The hoisting algorithm to move a load instruction to the
earliest possible point in a control-flow graph.  It repeats the
two phases: first try to move the instruction to the beginning of
its basic block; if successful, try to move it into the common
ancestor of the block's predecessors.}
\label{f:hoist}
\end{figure}

\subsection{Error Constraint Generation}

\paragraph{Conversion constraint.}
\sys by default does not generate constraints for checking integer
conversions.  One may simply invoke GCC with \cc{-Wconversion} to
inspect potentially dangerous conversions.
[[[\sys does something for critical integers, array indices, annotated sizes.]]]

\paragraph{In-loop constraint.}
Move in-loop constraints out.

\subsection{Path Constraint Generation}

Path constraint generation.

unroll loops once.

\subsection{Value Range Inference}

Range constraint \& annotations?

\subsection{Limitations}

miss bugs in some configurations, architectures,
and assembly code.
